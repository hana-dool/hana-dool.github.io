---
title: "One tail vs Two Tail Test in AB Testing"
excerpt: "AB Test 에서 One Tail 을 쓸까 Two Tail 을 쓸까?"
categories:
  - AB_Testing
last_modified_at: 2021-11-02

toc: true
toc_label: "Table Of Contents"
toc_icon: "cog"
toc_sticky: true

use_math: true
---

 AB Testing 시에 우리는 가설설정을 Two tail 을 쓸지 또는 One tail 을 쓸지에 대해서 고민이 될 수 있습니다. 이 때에 어떤 Test 가 좋고 어떤 Test 가 안좋은지에 대해서 알아봅시다.
{: .notice--warning}

# [One tail Test](#link){: .btn .btn--primary}{: .align-center}

- 여기에서는 One tail test 를 옹호하는 입장에서 어떤 말을 하는지에 대해서 알아봅시다.

> ## Introduction

- 일반적으로 양측검정은 다음과 같은 이점이 있다고 말합니다.
  - 보다 정확하고 신뢰할 수 있는 결과를 제공
  - 모든 시나리오 (하락 또는 증가) 에 대해서 검정(설명) 을 제공 가능 
  - 적은 가정으로 가능 
  - 일반적으로 더 좋음
- One tail Test 는 다음과 같은 단점이 있다고 합니다.
  - 더 높은 Type 1 error
  - 오로지 하나의 시나이로에 대해서만 검정 
  - 부정확하고 Biased 된 Results 로 이끔 
- 슬프게도 위와 같은 오해가 학계 전반에 팽배해 있습니다. 
  - 그중 일부는 Two Sided Test 가 Default 이고 One sided Test 를 할떄에는 마치 그러한 단측검정을 수행한 결과를 정당화 하려 한다고 생각합니다. 

> ## Where misconceptions Comes from? 

- 조와 아베가 비즈니스 연구 저널에 발표한 마케팅 연구의 통계적 관행에 대한 연구에서 다음과 같이 검정의 오해와 그로 인한 오용을 말했고, 이게 널리 퍼져있습니다. 
- <https://hyperconnect.github.io/2021/02/26/auto-stats-test.html>

> 많은 책 / 토론 / 글 등에서 나옵니다. 

```
“예상값 이 기준값 보다 크거나 작을 수 있는 경우, 예를 들어 응시자 가 과거 평균보다 높은 점수를 받을 수 있는지 또는 낮은 점수를 받을 수 있는지 여부 와 같이 양측 테스트가 적절합니다 . 예를 들어 기계가 1% 이상의 결함 제품을 생산하는지 여부와 같이 추정 값 이 기준 값에서 한 방향으로만 벗어날 수 있는 경우 단측 검정이 적합합니다 ."
```

```
“단측 가설 또는 방향성 가설 은 결과가 나올 실제 방향을 예측 합니다. 그것은 더 정확하고 일반적으로 다른 연구가 이전에 수행되었을 때 사용되어 결과가 어떤 방향으로 진행될 것인지에 대한 좋은 아이디어를 제공합니다.

양측 가설 또는 무방향 가설 은 OPEN 결과를 예측 하므로 결과가 두 방향으로 갈 수 있습니다. 매우 일반적으로 남겨두고 이전에 다른 연구가 수행되지 않은 경우 일반적으로 사용되므로 어떤 일이 일어날지 알 수 없습니다. 예를 들어 차이, 효과 또는 변화를 예측하지만 어떤 방향으로 가는지는 모릅니다."
```

- (그 답변이 6,000번 이상 조회되었지만) 매우 영향력 있는 출처이기 때문에 인용한 것이 아니라 다른 수많은 곳에서 본 나쁜 조언을 훌륭하고 명확하게 요약하고 있기 때문입니다.

> 다음과 같은 상황

- A/B Testing 이 수행되었고 대조군 (A) 와 다른 버젼 (B) 을 테스트 합니다.
  - 각 변종은 10000명의 사용자가 경험하며 둘 사이에서 무작위하다고 합시다.
  - A 는 20% 이고 B 는 21% 로 전환합니다. 
  - 단측검정의 유의성 검정은 96.01 (p값 0.039) 이므로 95% 수준 (0.05) 에서 유의한 것으로 간주됩니다.

![png](/assets/images/Stat/91_1.png)

- 이때 위의 검정을 양측검정으로 바꾸어 봅시다. 
  - 양측 검정을 놀랍게도 92.2% 의 유의성 (p 값 0.078) 이 나오게 됩니다. 
  - 즉 95% 수준에서 더이상 유의하지 않은것입니다.

> ## Why using Test?

- 우리는 왜 두가지 유형의 테스트가 존재하는지부터 알ㅇ야 합니다. 
- 우리는 결정 절차의 일부로 테스트를 사용합니다.
- 여기서 우리는 테스트 전에 테스트할 대상과 중요도 임계값 (대부분은 95% 사용) 을 사용하지만 이러한 숫자에 대해서 일반적으로는 아무런 ㅛ능이 없다는것을 미리 기억하세요! 
  - 우리가 방지하고자 하는것은 제 1종 오류와 제 2종 오류입니다.
- 우리가 AB Testing 을 사용할에는 임계값을 초과하는 경우 Treatment 를 적용하게 되고, 그렇지 않으면 Treatment 를 적용하지 않습니다. 
- 이러한 틀 내에서 귀무가설은 우리가 확인하려는 대상이 아닙니다. 
- 이에 비추어 양측검정은 어떤 방향에서든 통계적으로 유의한 차이가 발생되는 경우 동일한 방ㅂ식으로 행동하거나 동일한 결론을 도출할떄에만 사용되어야 합니다. 
  - 예를 들어서 전환률 최적화, 랜딩 페이지 최적화 등의 AB Testing 에서 얼마나 자주 수행하나요
- 다음과 같은 3개의 오류가 있을 수 있스빈다.
  - 제 1종 오류 
  - 제 2종 오류
  - 제 3 오류 (통계적으로 유의한 효과의 방향에 대해 선언하기 위해 양측가설, 검정을 수행하는 경우 이 오류는 테스트가 제어되지 안음)

> ## One tail Test

- 단측 가설은 설계에서 방향성이 존재합니다.
  - 예를 들어서 A/B Testing 을 계획시에 결과가 더나은 성느이면 나은

> ## 단측 검정과 양측 검정의 차이점 

- 두 테스트 사이에 가장 중요한 차이점은 우리의 의도입니다.
  - 효과의 방향에 상관 없이 행동이 동일하면 양측검정을 사용해야 합니다.
  - 하지만 결과가 양성일떄와 음성일떄에 행동이 달라진다면 단측 검정을 수행해야 합니다.
- 양측 검정에 비해 단측 검정에서 유의한 결과를 얻는것이 더 쉬운 이유는 뭘까요? 
  - 단측 검정의 95% 유의성이 양측검정의 90% 유의성과 같은 이유는 뭘까요? 
- 이들은 서로 다른 질문에 답하기 떄문에 다른 질문보다 더 구체적이니다.
- 단측 검정은 우리가 관심을 가지는것을 제한합니다. 

> ## 단측검정을 두개 시행한다고 생각하자

- '다르다' 를 알때에 그 Treatment 가 같다면 양쪽 p-value 를 95% 수준으로 정하고 Testing 할 수 있습니다. 
  - 이는 에러를 
- Freq Testing 는 어떤 Logic 으로 진행될까요? 
  - 그것은 첫째로 '우리가 사전에 Error 를 Bounded' 하고 이를 토대로 계산해 내겠다! 라는것입니다. 

> ## 1. Testing 을 통해서 배울 수 있음 

- 단측검정만 실시하는 경우에는, 이 Treatment 가 실제로 차이가 있나? 없나? 를 알 수가 없음 
  1. Treatment 가 "효과없거나 안좋음"  
  2. Treatment 가 좋음 

- 양측검정을 하게 될 경우 그 결과는 두가지 Case 가 있음
  1. Treatment 가 안좋음 
  2. Treatment 가 좋음
  3. Treatment 는 효과없음
- 위와 같이 3가지 케이스에 대해서 말해주기 떄문에, 우리는 Testing 의 결과로 좀 더 '배울 수 있음'

> ## 2. Error 를 우리가 생각한데로 Bounded 하기가 힘듦

- 양측검정을 하게 될 떄에 우리는 다음과 같은 시나리오가 있습니다.
- 우리가 진정으로 에러라고 생각하는게 뭘까요? 
  - Control = Treatment 인데 Control > Treatment 로 결정 
  - Control = Treatment 인데 Control < Treatment 로 결정 
- 이 떄에 

- 효과가 없는데 효과가 있다고 말해버릴 떄의 에러 (Type 1 Error)
- 효과가 있는데 효과가 없다고 말해버릴 떄의 에러 
- Control / Treatment 가 차이가 없는데 Control > Treatment 로 결정나는 경우 
  - (사실) 
- Control = Treatment 인데 Control < Treatment

 MCMC 를 이용한 좀 더 정확한 A/B Testing 입니다. 이것을 적용하기 위해서는 역시나 '모든 분포를 잘 근사할 수 있는 다양한 분포에 대해 Bayesian model 을 얼마나 만들 수 있을까?' , '정확하게 posterior 를 구하기 위해 MCMC 는 얼마나 해야하나?' 와 같은점을 해결해야 할 것 같네요.
{: .notice--success}

