---
title: "A/B Testing and Covid-19: Data-Driven Decisions in Times of Uncertainty"
excerpt: "Covid 와 같이 불안정한 시대에서의 AB 테스트"
categories:
  - AB_Microsoft
last_modified_at: 2021-12-25

toc: true
toc_label: "Table Of Contents"
toc_icon: "cog"
toc_sticky: true

use_math: true
---

 AB 테스트가 Covid 에서 어떻게 이루어지는지 알아봅시다.
{: .notice--warning}

# [AB Testing in Covid](#link){: .btn .btn--primary}{: .align-center}

> ## Introduction

- 우리는 몇주, 몇달동안 새로운 기능을 개발하고 사용자에게 릴리즈 했습니다. 하지만 출시 이에 서비스에 대한 사용가 관심을 추적하는 핵심 지표가 꾸준히 감소하는것을 관찰할 수 있었습니다.

![png](/assets/images/Stat/135_1.png)

- 위 Metric 은 User Engagement with our service 를 나타냅니다. 우리 Feature 가 릴리즈 한 이후에 메트릭이 꾸준히 감소하고 있는것을 알 수 있습니다.
  - 이때에 우리는 어떻게 해야할까요? Update 내용을 Roll Back 해야할까요? 
- 이때 주의해야 할 점은, 우리는 업데이트를 Release 한 이후 성능 변화를 측정했다는 것입니다. 즉 메트릭이 낮아진 원인이 새로 추가한 기능 때문인지, 아니면 외부요인 (코로나 등) 때문인지 알 수 없다는 것이죠
  - 그러므로 위의 그래프만으로는 , Metric 의 영향을 알 수 없으므로, 위 그래프만 보고서는 Update 된 내용을 롤백할수는 없습니다. 
- 이 경우 해결책은 A/B 테스트를 통해, 새로 추가한 기능의 효과에 대한 인과 추론을 해서, '진짜로 추가한 기능때문에 Metric 의 값이 낮아졌는지' 를 알아내야 할 것입니다.

> ## A/B tests randomize users into two groups.

> A/B Testing Example 

- A/B 테스트는 사용자그룹이 2개로 나뉘고, 아래 그림처럼 랜덤하게 하나의 유저에 대해서 Control 과 Treatment 가 표시되고 그 효과를 비교하게 됩니다.( 아래는 Azure ID의 A/B 테스트 예시)

![png](/assets/images/Stat/135_2.png)

- 이떄 외부 영향 (마케팅 효과, 시계적인 이벤트, 계절성 등) 은 두 사용자 모두에게 영향을 미치게 됩니다. 
  - 그러므로 우리는 Treatment 가 기능에 미치는 영향을 올바르게 추정할 수 있습니다. (즉 인과추론을 바르게 추정할 수 있다는 것입니다.)

> AB Test with Time Series Graph

![png](/assets/images/Stat/135_3.png)

- 위 그림의 상단 그림은 시간 흐름에 따라서 A와 B 차이에 대한 신뢰 구간 그래프를 나타냅니다.
- 하단 그림은 메트릭의 '실제' 값을 나타냅니다. 
- 이는, A/B 테스트를 통해서 직접 비교할 때 기능업데이트 가 성능 저하의 원인이 아님을 알 수 있습니다 .
  - 왜냐하면 이전 버전(A)과 이후 버젼(B) 모두 성능이 저하되고 있기 떄문이죠 (두 버전 차이는 없고, 실제값은 하락중이므로)
  - 즉 A/B 테스트 데이터 결과를 보면, 기능을 롤백해도 감소가 되돌릴 수 없음을 보여줍니다.

# [A/B Testing in the era of Covid-19](#link){: .btn .btn--primary}{: .align-center}

> ## 코로나 시대의 A/B 테스트

- 이와 같은 시나리오는 2020년 3월경 Microsoft에서 상당히 일반적인 시나리오였습니다.
  - 실제로 , 위에 차트로 표시된 메트릭 그래프는 3월 초에 시작된 Microsoft 제품의 A/B 테스트의 한 예입니다. 
- 이 기간 동안 많은 사람들이 실직, 근무 시간 단축, 재택 근무/공부 시작 등으로 일상에 엄청난 변화가 있었습니다.
  - 그럼에 따라서 사람들의 삶이 엄청나게 바뀌었고 제품과 서비스에 대한 참여의 형태도 매우 많이 바뀌었고, 바뀌는 도중이였습니다.
  - 그래서 A/B 테스트에 대한 결과도 매우 불안정 했습니다.

- 이 게시물에서는 이렇게 불확실한 시기에 A/B 테스트를 사용하기 위한 지침을 공유해보려 합니다. 

> 서비스의 안정성/퍼포먼스를 개선하는 기능의 경우에도 A/B 테스트 해야하나요?

- 버그 수정조차도 의도하지 않은 결과를 초래할 수 있습니다.
- Microsoft의 ExP 팀에서는 이러한 코드 변경을 완전히 배포하기 전에 A/B 테스트를 통해 코드 변경로 인해 유저에게 미치는 영향을 측정하고 이해하는 것이 항상 더 낫다는 것을 배웠습니다.
- 즉 사용자의 경험에 영향을 줄것같지 않더라도, A/B 테스트를 사용하여 변경사항을 안전하게 배포합시다!

>  AB 테스트의 결과가 지금과 같은 격변의 코로나시기에도 유효할까요??

- AB 테스트의 장점은 '두 그룹에 대해 모든 외부요인이 같다' 라는 것입니다.
- 즉 코로나 시기든 어떤 시기든 AB Test Framework 는 늘 유의합니다.
  - 물론 이 결과가 '현재 실험 중' 에만 국한된다는 단점이 있습니다. (이에 대해서는 아래에서 알아보도록 합시다.)

> 지금같이 격변의 시기에 진행한 A/B 테스트가 코로나 이후에 삶이 정상화되도 유의할까요?

- 우리는 알 수 없습니다! 
- 사용의 행동은 시간이 지남에 따라 항상 변하기 때문에 기능의 영향이 지금부터 2개월, 3개월 또는 12개월 후에도 지속될지는 알 수 없습니다.
  - A/B 테스트는 단지 현재 사용 패턴에 대한 기능을 최적화하는 데 도움이 됩니다.
- 그래도 하지만 한가지 안심할점은 사람들의 활동, 작업 스타일 및 관심사가 그렇게 급격하게 변경되지는 않는다는것입니다. 그러므로 너무 불안해 하지는 마세요.
  - 하지만 그렇다고 해서 현재 결과가 미래에도 계속 일정할것이라고 가정하지 마세요. 코로나 이전 패턴을 참고하는 등, 과거를 이용해서 유저의 효과 추이를 어림짐작하지 마세요. 지금은 격변의 시기이기 떄문입니다.
- 그러므로  A/B 테스트를 실행하고 완전히 배포하기로 결정했다고 합시다. 그러면 Treatment 가 안정화되고 난 이후에도 이전의 변형(Variant) 에 대해서 다시 비교하는 A/B 테스트를 실행하는게 좋습니다. 
  - A/B 테스트를 다시 실행하면 Treatment effect 가 크게 변경되었는지 확인할 수 있습니다. 특히 다음과 같은 경우에 이러한 Re-reunning 을 고려하세요

> Example of ReRunning

- 결과가 예상치 못하거나, 이전 테스팅 결과와 모순될떄 

- result categories 들을 재정렬하는 기능일 경우

  - (ex : 이전에 여행상품 쿼리 추천을 우선시 하게 하는 기능을 출시했다고 합시다. 하지만 현재 코로나 시기에는 이러한 기능은 오히려 안좋을 것입니다.).

- 기능의 기반이 되는 모델이, 그 기간의 User Data 를 학습하여 이루어진 경우 

  - (예: 최근 데이터에 대해 학습된 추천 알고리즘) 이 경우에는 유저가 시간에 따라 바뀔 수 있으므로, 코로나 시기에는 매우 안좋은 feature 일 수도 있을것입니다.

- 사용자 세그먼트는 새로운 기능에 대한 반응이 매우 다른경우

  - (ex 신규 사용자 vs. 숙련된 사용자.) 많은 products 의 경우 신규 사용자 비율은 시간마다 달라집니다. (코로나 시기의 경우에는 신규 사용자 비율이 더 높겠죠?) 즉 만일 product 의 효과가 사용자의 친숙도(숙련도) 에 큰 관련이 있는 기능의 경우 신규 사용자의 비율에 따라서 효과가 천지차이일 수 있습니다. 그러므로 코로나 시기처럼 segment 비율이 크게 달라진 경우 Re-Running 이 필요하죠

  - (ex : 다른 지리적 지역마다 크게 다를때) Covid 가 모든 세계에 영향을 끼치고 있지만, 지역마다 그 강도는 다릅니다. (미국의 경우 엄청나게 타격을 입었지만, 대만은 비교적 낮은 영향을 받았죠.) 그러므로 이러한 지역별 차이가 발생하므로 A/B 테스트를 Re-Running 해야할 수 있습니다. 

- 항상 유저들은 변하기 때문에 우리가 출시한 기능에 대해서도 늘 비판적으로 생각하고, 떄에 따라서는 Re-running 이 필요한지 항상 고민하는게 좋습니다. 

> 우리 팀에는 출시를 보류한 기능의 백로그가 있는데, 다음에는 어떤일을 해야할까요?

- 각 기능을 독립적으로 A/B 테스트할 계획을 세웁니다. 
  - 여러개의 기능을 한번에 릴리즈 하면, 각각의 효과를 제대로 알기가 어습니다. 그러므로 각 AB 테스트에서 기능의 변경사항의 영향을 체크하고 배포하는것이 중요합니다. 
- 많은 팀들이 동시에 새로운 기능을 출시하는경우, 사용자는 제품이 전체적으로 변하기 때문에, 적응하기 힘들 수 있습니다.
  - 그러므로 시차를 두고 릴리즈를 하는게 좋습니다.
- Feature Release 가 지연되어야하는지 여부를 결정합니다.
  - 기능이 만일 Covid 이전의 비즈니스/생활 라이프를 향상시키는 기능이라고 합시다. 
    - 이러한 경우는 Covid 의 영향이 없어지고, 우리가 의도한 상황(Covid 이전의 상황) 이 오기까지 기다려야 합니다.
  - 즉 '우리가 개선하고자 하는 상황' 과 같은 상황일때에 기능을 배포하는것이 좋습니다.

> ## Conclusion

- 이처럼 불확실한 시대에, A/B 테스트를 적절히 사용하여 Uncertailnty 를 줄이도록 합시다.
