---
title:  "Argparse Module"
excerpt: "파이썬 스크립트를 다루는 방법"
categories:
  - Py_Advanced
last_modified_at: 2021-09-29

toc: true
toc_label: "Table Of Contents"
toc_icon: "cog"

use_math : true
---

 py 의 내용을, shell 에서 실행하고, shell 에서 인자값까지 전달하여 파이썬을 실행하는 모듈입니다. 
{: .notice--warning}

# [Argparse 모듈](#link){: .btn .btn--primary}{: .align-center}

> ## argparse 구현해보기 

- Arparse 는 자주 사용되는 모듈중에 하나입니다.

```python
# argparse_example.py
import argparse

# 인자값을 받을 수 있는 인스턴스 생성
parser = argparse.ArgumentParser(description='Argparse Tutorial')

# 입력받을 인자값 설정 (default 값 설정가능)
parser.add_argument('--epoch',          type=int,   default=150)
parser.add_argument('--batch_size',     type=int,   default=128)
parser.add_argument('--lr_initial',     type=float, default=0.1)

# args 에 위의 내용 저장
args = parser.parse_args()

# 입력받은 인자값 출력
print(args.epoch)
print(args.batch_size)
print(args.lr_initial)
```

- 위와같은 스크립트를 argparse_example.py 라는 이름으로 저장했다고 합시다. 
- 그 이후에 터미널을 이용하여, 이 파이썬을 읽게 하면 아래와 같이 출력됩니다. 



```python
# python 파일을 터미널에서 실행 시킨다.

$ python argparse_example.py 

  150  # default epoch
  128  # default batch size
  0.1  # default learning rate


# 뒤쪽에 -h 또는 --help 를 붙이면 내용에 대해서 보여준다.

$ python argparse_example.py -h 

  usage: argparse_example.py [-h] [--epoch EPOCH] [--batch_size BATCH_SIZE]
                             [--lr_initial LR_INITIAL]

  Argparse Tutorial

  optional arguments:
    -h, --help            show this help message and exit
    --epoch EPOCH
    --batch_size BATCH_SIZE
    --lr_initial LR_INITIAL


# 다음과 같이 명령시에 직접 값을 설정해 적용할 수 있습니다.
$ python argparse_example.py --epoch=256 --batch_size 64 --lr_initial 0.1111

  256    # epoch
  64     # batch_size
  0.1111 # learning rate 
```

- 머신러닝에서는 위와 같은 모듈을 다음과 같이 사용합니다. 
  - main.py : 모델 학습/평가가 수행되는 파이썬 코드 
  - main.sh : main.py 에 특정한 하이퍼 파라미터를 부여하는 코드   ( run in shell )

> ## main.py

```python
# main.py

import argparse

# 인자값을 받을 수 있는 인스턴스 생성
parser = argparse.ArgumentParser(description='Argparse Tutorial')

# 입력받을 인자값 설정 (default 값 설정가능)
parser.add_argument('--epoch',          type=int,   default=150)
parser.add_argument('--batch_size',     type=int,   default=128)
parser.add_argument('--lr_initial',     type=float, default=0.1)

# args 에 위의 내용 저장
args    = parser.parse_args()

# 입력받은 인자값 출력
print(args.epoch)
print(args.batch_size)
print(args.lr_initial)
```

```python
# main.sh

# 본인이 원하는대로 값을 설정해줄 수 있다.

python argparse_example.py  # default value
python argparse_example.py --epoch=200 --batch_size=256 --lr_initial=0.3
python argparse_example.py --epoch=300 --batch_size=64 --lr_initial=0.03
python argparse_example.py --epoch=400 --batch_size=32 --lr_initial=0.003
```

- 위와 같이 py , sh 파일을 만든 후에 터미널에서 sh 파일을 실행시킬 수 있습니다. 

```python
$ sh main.sh

  # 결과
  150    # default epoch
  128    # default batch size
  0.1    # default learning rate

  200    # epoch
  256    # batch size
  0.3    # learning rate

  300    # epoch
  64     # batch size
  0.03   # learning rate

  400    # epoch
  32     # batch size
  0.003  # learning rate

```

# [ArgumentParser](#link){: .btn .btn--primary}{: .align-center}

class argparse.ArgumentParser(prog=None, usage=None, description=None, epilog=None, parents=[], formatter_class=argparse.HelpFormatter, prefix_chars='-', fromfile_prefix_chars=None, argument_default=None, conflict_handler='error', add_help=True, allow_abbrev=True)
{: .notice}

- 이는 프로그램 인자에 대한 정보를 채우는 명령어입니다. 
- 모든 매개 변수는 키워드 인자로 전달되어야 합니다. 
- 많이 사용되는것 위주로 설명하겠습니다. 

> ## Prog : 프로그램의 이름

- .py -h 를 실행할때에 프로그램의 이름을 어떻게 출력할지에 대한 옵션입니다.
- 기본값은 sys.argv[0] 입니다.
  - 이러한 sys.argv[0] 에는 스크립트가 놓여지는 장소가 저장됩니다. 

```
PS C:\Users\goran\Desktop\병아리> python temp.py -h
usage: temp.py [-h] [--epoch EPOCH] [--batch_size BATCH_SIZE]
               [--lr_initial LR_INITIAL]

Argparse Tutorial

optional arguments:
  -h, --help            show this help message and exit
  --epoch EPOCH
  --batch_size BATCH_SIZE
  --lr_initial LR_INITIAL
```

- 위에서 usage : temp.py 가 바로 그 부분입니다. 
  - 현재 실행되고있는 파일의 이름을 출력하게 됩니다.

```python
import argparse
# 인자값을 받을 수 있는 인스턴스 생성
parser = argparse.ArgumentParser(prog = 'Gorany Program', # 고라니 프로그램이라 지정
                                 description='Argparse Tutorial')
... 
```

- 위와 같이 prog 에 Gorany Program 이라고 설정할 경우 shell 에서 실행했을때에는 다음과 같이 나오게 됩니다. 

```
PS C:\Users\goran\Desktop\병아리> python temp.py -h
usage: Gorany Program [-h] [--epoch EPOCH] [--batch_size BATCH_SIZE]
                      [--lr_initial LR_INITIAL]

Argparse Tutorial

optional arguments:
  -h, --help            show this help message and exit
  --epoch EPOCH
  --batch_size BATCH_SIZE
  --lr_initial LR_INITIAL
```

> ## Usage : 프로그램 사용법

- Usage 는 프로그램 사용법을 나타내는 인자입니다.
  - 이는 prog 와 같이 정의될경우, prog 를 string 에 넣지 않는 한 prog 는 없어지게 됩니다.

```python
import argparse
import sys
# 인자값을 받을 수 있는 인스턴스 생성
parser = argparse.ArgumentParser(prog = 'Gorany Program',
                                 usage= '이 프로그램을 사용하는 방법은 어쩌구저저구 입니다.',
                                 description='Argparse Tutorial')

# 입력받을 인자값 설정 (default 값 설정가능)
parser.add_argument('--epoch',          type=int,   default=150)
parser.add_argument('--batch_size',     type=int,   default=128)
parser.add_argument('--lr_initial',     type=float, default=0.1)

# args 에 위의 내용 저장
args = parser.parse_args()

# 입력받은 인자값 출력
print(args.epoch)
print(args.batch_size)
print(args.lr_initial)
```

- 위와 같이 정의하게 된다면 아래와 같이 나오게 됩니다. 

```
$ C:\Users\goran\Desktop\병아리> python temp.py -h
usage: 이 프로그램을 사용하는 방법은 어쩌구저저구 입니다.

Argparse Tutorial

optional arguments:
  -h, --help            show this help message and exit
  --epoch EPOCH
  --batch_size BATCH_SIZE
  --lr_initial LR_INITIAL
PS C:\Users\goran\Desktop\병아리>
```

- prog 가 없어진것을 볼 수 있습니다. 

```python
import argparse
import sys
# 인자값을 받을 수 있는 인스턴스 생성
parser = argparse.ArgumentParser(prog = 'Gorany Program',
                                 usage= '%(prog)s 파일에서 시행되었습니다.  프로그램을 사용하는 방법은 어쩌구저저구 입니다.',
                                 description='Argparse Tutorial')
...
```

```
$ C:\Users\goran\Desktop\병아리> python temp.py -h
usage: Gorany Program 파일에서 시행되었습니다.  프로그램을 사용하는 방법은 어쩌구저저구 입니다.

Argparse Tutorial

optional arguments:
  -h, --help            show this help message and exit
  --epoch EPOCH
  --batch_size BATCH_SIZE
  --lr_initial LR_INITIAL
```

- 위와 같이 %(prog)s 를 string 에 넣어서 prog 인자를 출력할 수 있습니다.

> ## description 

- 인자 도움말 전에 표시될 텍스트를 의미합니다.

```python
import argparse
import sys
# 인자값을 받을 수 있는 인스턴스 생성
parser = argparse.ArgumentParser(prog = 'prog에서 설정한 인자입니다.',
                                 usage= '%(prog)s 파일에서 시행되었습니다. usage 에서 설명하는 부분입니다..',
                                 description='description 에서 정의된 부분입니다.')

# 입력받을 인자값 설정 (default 값 설정가능)
parser.add_argument('--epoch',          type=int,   default=150)
parser.add_argument('--batch_size',     type=int,   default=128)
parser.add_argument('--lr_initial',     type=float, default=0.1)

# args 에 위의 내용 저장
args = parser.parse_args()

# 입력받은 인자값 출력
print(args.epoch)
print(args.batch_size)
print(args.lr_initial)
```

```ㅔㅛ
$ C:\Users\goran\Desktop\병아리> python temp.py -h
usage: prog에서 설정한 인자입니다. 파일에서 시행되었습니다. usage 에서 설명하는 부분입니다..

description 에서 정의된 부분입니다.

optional arguments:
  -h, --help            show this help message and exit
  --epoch EPOCH
  --batch_size BATCH_SIZE
  --lr_initial LR_INITIAL
```

- 위와 같이 desription 이 정의된 부분을 살펴볼 수 있습니다. 

# [add_argument()](#link){: .btn .btn--primary}{: .align-center}

- 인자를 구분하여 분석하는 방법을 정의하게 됩니다. 
  - 이떄에 모든 매개변수는 키워드 인자로 전달되어야 합니다. 
  - 이 떄에 각각 어떻게 전달되어야 하는지에 대해서 알아보겠습니다. 

> ##  type : 기본적인 타입 지정

```python
# temp.py
import argparse

parser = argparse.ArgumentParser()
parser.add_argument('--value',type = str)
args = parser.parse_args()
print(args.value**2)
```

- 위와 같이 type 을 지정할 경우에는 , 기본적으로 인자에 대한 type을 지정하게 됩니다. 

```
$ C:\Users\goran\Desktop\병아리> python temp.py --value 3
Traceback (most recent call last):
  File "temp.py", line 8, in <module>
    print(args.value**2)
TypeError: unsupported operand type(s) for ** or pow(): 'str' and 'int'
```

- 위와 같이 셸에서 실행시에 --value 에 2를 넣었지만 이는 잘 적용되지 않는것을 볼 수 있습니다.
- type 지정을 string 으로 했기 때문입니다.

> ## Help : 인자에 대한 설명

```
PS C:\Users\goran\Desktop\병아리> python temp.py -h
usage: temp.py [-h] [--value VALUE]

optional arguments:
  -h, --help     show this help message and exit
  --value VALUE  제곱이 되어질 값을 여기에 넣게 됩니다.
PS C:\Users\goran\Desktop\병아리>
```

- 위와 -h 를 이용할 경우 같이 인자에 대한 설명을 할 수 있게 됩니다. 

> ## default : 기본값을 지정

```python
import argparse
parser = argparse.ArgumentParser()
parser.add_argument('--value',type = int, default = 3)
args = parser.parse_args()
print(args.value**2)
```

- 위와 같이 parser 정의시에 default 를 정할 경우에는, 인자가 입력되지 않는 경우 기본값을 몇 가져야 하는지에 대해서 설정할 수 있습니다. 

```
PS C:\Users\goran\Desktop\병아리> python temp.py
9
```

> ## require : 필수에 대한 여부

```python
import argparse
parser = argparse.ArgumentParser()
parser.add_argument('--integer',type = int)
parser.add_argument('--value2',type = int)
args = parser.parse_args()
print(args.value2**2)
```

- 위와 같이 설정을 하게 될 경우, --integer 가 없더라도 잘 작동됩니다. 

```
PS C:\Users\goran\Desktop\병아리> python temp.py --value2 4
16
```

- 위와 같이 python 에 대해서 --value2 에 대해서 4 넣어도 작동되는것을 볼 수 있습니다. 

```python
import argparse
parser = argparse.ArgumentParser()
parser.add_argument('--integer',type = int , required = True)
parser.add_argument('--value2',type = int)
args = parser.parse_args()
print(args.value2**2)
```

- 위와 같이 required 를 지정할 경우에는 '필수로 인자에 넣어주어야' 합니다. 

```python
PS C:\Users\goran\Desktop\병아리> python temp.py --value2 4
usage: temp.py [-h] --integer INTEGER [--value2 VALUE2]
temp.py: error: the following arguments are required: --integer
```

- 위와 같이 --integer 를 입력하지 않아서 에러가 나는것을 볼 수 있습니다. 

**reference**

- <https://supermemi.tistory.com/69>
- <https://docs.python.org/ko/3/library/argparse.html#prefix-chars>
- <https://brownbears.tistory.com/413>

