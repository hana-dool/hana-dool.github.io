---
title:  "Kit_1"
excerpt: "여러 예제"
categories:
  - SQL_Kit
tags:
  - 1
last_modified_at: 2021-05-17

toc: true
toc_label: "Table Of Contents"
toc_icon: "cog"
toc_sticky: true

use_math: true
---

<br>

# <center><font size="6"> 상위 N명 </font></center>

```sql
SELECT *
FROM (SELECT * FROM 테이블 ORDER BY 정렬할 열)
WHERE rownum = N ; 
-- 상위 N 명의 출력 
```

- rownum 은 주로 여러개의 결과를 출력하는 쿼리문을 실행 후 결과의 개수를 제한하여 가져오는데 쓰인다.
- rownum 은 테이블에 없더라도 쓸 수 있는 값이다.

```sql
SELECT *
FROM 테이블
WHERE rownum = N ; 
ORDER BY 정렬할 열 
-- 이렇게 하면 틀린것이다.
```

- 쿼리가 실행되는 순서는 FROM - WHERE - GROUP BY - SELECT - ORDER BY 이다.
- 그리고 ROWNUM 값이 할당되는 건 GROUP BY - ORDER BY 사이다. 즉 ORDER BY 전에 ROWNUM이 할당되면 안되기 때문에 위의 방법은 틀린것이 된다.

<br>

# <center><font size="6"> distinct  한 수</font></center>

```sql
SELECT COUNT(DISTINCT(col))
FROM df
WHERE col is not NULL 
```

- Distinct 한 col 의 수를 센다.
- 이때에 col 에서 Null 이 있는 경우는 무시한다.

<br>

# <center><font size="6"> upper, lower 로 정확한 검색</font></center>

```sql
SELECT *
FROM df
WHERE lower(name) = 'alex'
-- 위와 같이 lower 을 이용하게 된다면, Alex ALEX 등, 이름에 대소문자가 섞여있는 경우도 unique 하게 잘 구별할 수 있다.
```

<br>

# <center><font size="6">이메일 도메인 출력</font></center>

```sql
-- 먼저 @ 의 위치를 INSTR 으로 출력한다.
SELECT INSTR('abcd@naver.com')
FROM df 
```

이 출력 결과는 다음과 같다. 

| INSTR('abcd@naver.com') |
| ----------------------- |
| 5                       |

즉 이를 이용하게 된다면 다음과 같은 쿼리를 짤 수 있다.

```sql
SELECT SUBSTR('abcd@naver.com', INSTR('abcd@naver.com','@') + 1)
```

위를 실행하게 되면 아래와 같이 나오게 된다.

| SUBST.... |
| --------- |
| naver.com |

정리하면 도메인을 뽑아내는 쿼리는 다음과 같아진다. 

```sql
SELECT SUBSTR(col,INSTR(col, '@')+1)
-- @ 이 나오는 위치를 찾아낸다.
-- 그 이후에 SUBSTR 를 이용해 그 위치부터 끝까지 모두 출력해본다. 
```

<br>

# <center><font size="6">Count distinct</font></center>

<br>

# <center><font size="6">Nan 집계</font></center>

```
NVL(col,지정값)
```

- NVL 은 Null Value 의 약자입니다.
- 위 경우 col 의 NAN 을 지정값으로 출력하게 됩니다
- Null 을 포함하는 연산의 경우 Null 이 나옵니다. 그러므로 연산이 들어가게 될 경우, 최대한 Null 을 다른값으로 바꾸어주는것이 좋습니다.

```sql
select nvl(col1,0) + nvl(col2,0)
from DF
```

- 위와 같은 식의 경우, null 을 0 으로 바꾼 이후에 계산을 하게 됩니다.

<br>

# <center><font size="6">Nan 집계2</font></center>

```sql
NVL2(col,값1,값2)
```

- 위는 nan 이 아니면 값1을 출력하고, nan 이면 값2를 출력하는 쿼리입니다.

```sql
SELECT NVL2(col,col+col2,0)
```

- 위 쿼리는 nan 이 아닐때에 col+col2 를 출력하고 nan 이면 0을 출력하게 합니다.

