---
title:  "Chisquare"
excerpt: "카이스퀘어 검정"
categories:
  - Mathematical_Statistics
last_modified_at: 2021-11-30

toc: true
toc_label: "Table Of Contents"
toc_icon: "cog"
toc_sticky: true
use_math: true
---

  순서통계량에 대해서 알아보기
{: .notice--warning}

# [Chi Square Testing](#link){: .btn .btn--primary}{: .align-center}

> ## Introduction

- 여기에서는 카이제곱검정(chi-square test)이라는 통계적 가설의 검정 방법을 소개하려 합니다. 
- 러한 종류의 검정은 원래 1900 년에 칼 피어슨(Karl Pearson)이 제안한 방법입니다.

> Theorem

- $i=1,2, \cdots, n$ 에 대해 확률변수 $X_{i}$ 가 $N\left(\mu_{i}, \sigma_{i}^{2}\right)$ 을 따르고 $X_{1}, X_{2}, \cdots, X_{n}$ 이 독립이라고 하 자. 그리면 이러한 변수의 결합 $\mathrm{pdf}$ 는 다음과 같습니다.

$$\frac{1}{\sigma_{1} \sigma_{2} \cdots \sigma_{n}(2 \pi)^{n / 2}} \exp \left[-\frac{1}{2} \sum_{i=1}^{n}\left(\frac{x_{i}-\mu_{i}}{\sigma_{i}}\right)^{2}\right], \quad-\infty<x_{i}<\infty$$

- (계수 $-1 / 2$ 을 제외하고 $)$ 지수에 의해 정의되는 확률변수는 $\sum_{i=1}^{n}\left[\left(X_{i}-\mu_{i}\right) / \sigma_{i}\right]^{2}$ 이고 이 확률 밴수는 $\chi^{2}(n)$ 분포를 가집니다.
- 이러한 확률의 결합정규분포를 의존하는 $n$ 개의 확률변수로 일반화했는데 이 분포를 다변량 정규분포(multivariate normal distribution)라고 한다.

> Theorem

- 이제 근사 카이제곱분포를 따르는 확률변수를 살펴보자. $X_{1}$ 이 $b\left(n, p_{1}\right)$ 을 따른다고 하자. 다음 확률변수는 $n \rightarrow \infty$ 일 때 근사적으로 $N(0,1)$ 분포를 따르게 됩니다. 

$$Y=\frac{X_{1}-n p_{1}}{\sqrt{n p_{1}\left(1-p_{1}\right)}}$$

- 뿐만 아니라 이 $Y^{2}$ 의 분포는 근사적으로 $\chi^{2}(1)$ 을 따르게 됩니다.zz
- $X_{2}=n-X_{1}, p_{2} = 1-p_1 , Q_1 = Y^2$ 이라고 합시다.  그렇다면 $\left(X_{1}-n p_{1}\right)^{2}=\left(n-X_{2}-n+n p_{2}\right)^{2}=\left(X_{2}-n p_{2}\right)^{2}$ 이므로 이를 이용하여 $Q_1$ 은 다음과 같이 나타낼 수 있습니다.

$$\begin{aligned} Q_{1}=\frac{\left(X_{1}-n p_{1}\right)^{2}}{n p_{1}\left(1-p_{1}\right)} &=\frac{\left(X_{1}-n p_{1}\right)^{2}}{n p_{1}}+\frac{\left(X_{1}-n p_{1}\right)^{2}}{n\left(1-p_{1}\right)} \\ &=\frac{\left(X_{1}-n p_{1}\right)^{2}}{n p_{1}}+\frac{\left(X_{2}-n p_{2}\right)^{2}}{n p_{2}} \end{aligned}$$

> ## Generalization

- $X_{1}, X_{2}, \cdots, X_{k-1}$ 은 모수 $n, p_{1}, \cdots, p_{k-1}$ 인 다항분포를 따른다고 합시다. 
- 이때  $X_{k}=n-\left(X_{1}+\cdots+X_{k-1}\right), p_{k}=1-\left(p_{1}+\cdots+p_{k-1}\right)$ 와 같이 정의할 수 있을것입니다. 그리고 $Q_{k-1}$ 은 다음과 같다고 합시다.

$$Q_{k-1}=\sum_{i=1}^{k} \frac{\left(X_{i}-n p_{i}\right)^{2}}{n p_{i}}$$

- 이때 위의 $n \rightarrow \infty$ 일 때 $Q_{k-1}$ 이 근사적으로 $\chi^{2}(k-1)$ 분포를 가지게 됩니다. 
- 일부 책에서는 $i=1,2$, $k$ 에 대해 각 $n p_{i}$ 가 적어도 5 가 되도록 $n$ 이 충분히 큰지 확인하고 이 근사적 방법을 이용하도록 주의를 당부하는 학자들도 있다.
  - 이는 위에서 우리의 통계량 $Q_{k-1}$ 이 카이제곱분포를 따르는 것이 아니라 근사 카이제곱분포를 따르기 때문에 생기는 기준입니다!

> Proof

- https://ocw.mit.edu/courses/mathematics/18-443-statistics-for-applications-fall-2006/lecture-notes/lecture11.pdf
  - 증명 리뷰는 나중에 하는것으로.... (시간이 없다! ㅜㅜ)

> ## Testing

- 확률변수 $Q_{k-1}$ 은 이제 논의할 어떤 통계적 가설검증의 기초로 사용할 수 있다. 
- 확률실험의 표본공간 $\mathcal{A}$ 를 유한개의 서로소인 집합 $A_{1}, A_{2}, \cdots, A_{k}$ 의 합집합이라고 하자. 또한 $p_{k}=1-p_{1}-$ $\cdots-p_{k-1}$ 에 대해 $P\left(A_{i}\right)=p_{i}(i=1,2, \cdots, k)$ 로, $p_{i}$ 는 확률실험의 결과가 집합 $A_{i}$ 의 원소일 확률이라고 하자. 
- 이 확률실험이 독립으로 $n$ 번 반복되었을 때 $X_{i}$ 는 결과가 집합 $A_{i}$ 의 원소일 횟수를 나타낸다. 즉 $X_{1}, X_{2}, \cdots, X_{k}=n-X_{1}-\cdots-X_{k-1}$ 은 실현값이 각각 $A_{1}, A_{2}, \cdots, A_{k}$ 의 원 소가 되는 빈도이다. 그러면 $X_{1}, X_{2}, \cdots, X_{k-1}$ 의 결합 $\mathrm{pdf}$ 는 모수 $n, p_{1}, \cdots, p_{k-1}$ 인 다항분포의 $\mathrm{pmf}$ 이다. 
- (이 다항분포의 $\mathrm{pmf}$ 에 관한) 단순가설을 아래와 같이 생각해봅시다.

$$H_{0}: p_{1}=p_{10}, p_{2}=p_{20}, \cdots, p_{k-1}=p_{k-1,0}\left(p_{k}\right.=p_{k 0}=1-p_{10}-\cdots-p_{k-1,0})$$ 

- 위에서.  $p_{10}, \cdots, p_{k-1,0}$ 은 우리가 테스트하고자 하는 값입니다. (즉 k=1 일때 $p_1 = 0.3 , p_2 = 0.7$ 을 테스트 할 수 있다는 의미입니다.) 
- 우리는 대립가설 $not H_0$ 에 대하여 $H_{0}$ 을 검정하고자 합니다.
- 가설 $H_{0}$ 이 참이라면 다음 확률변수는 자유도가 $k-1$ 인 근사 카이제곱분포를 따르게 됩니다.

$$Q_{k-1}=\sum_{i=1}^{k} \frac{\left(X_{i}-n p_{i 0}\right)^{2}}{n p_{i 0}}$$

> Intuition

- $H_{0}$ 이 참일 때 $n p_{i 0}$ 은 $X_{i}$ 의 기댓값이므로 다음과 같은 intuition 을 얻을 수 있습니다.
  - $H_{0}$ 참이면 $Q_{k-1}$ 은 작다! 
  - $H_0$ 이 거짓이면 $Q_{k-1}$ 은 크다!

> Decision Rule

- 위에 의거하면 우리는 다음과 같은 Decision Rule 을 가져야 함을 알 수 있습니다.
  - $Q_{k-1} \geq c$ 이면 $H_{0}$ 을 기각한다.
- 유의 수준은 카이제곱의 분포 표를 참고하면 될 것입니다.

> ## Example 1 : Dice

- 확률실험에서 점수 $1 \sim 6$ 중 하나를 선택한다고 합시다.(예: 주사위를 던져서). $A_{i}=\{x: x = i \} (i=1,2..6)$ 
- 가설 $H_{0}: P\left(A_{i}\right)=p_{i 0}=1 / 6(i=1,2, \cdots, 6)$ 을 검증하려 한다고 합시다. (즉 우리는 주사위가 공평한지 알고싶습니다.)
- 이때 위의 가설을 검정하기 위하여 얻은 실험 데이터는 $A_{1}, A_{2}, \cdots, A_{6}$ 의 실험 빈도는 각각 $13,19,11,8,5,4$ 라고  합시다. 

$$\frac{(13-10)^{2}}{10}+\frac{(19-10)^{2}}{10}+\frac{(11-10)^{2}}{10}+\frac{(8-10)^{2}}{10}+\frac{(5-10)^{2}}{10}+\frac{(4-10)^{2}}{10}=15.6$$

- 이때 qchisq $(0.95,5)$ 는 11.075 입니다. 15.6>11.0705 즉 이므로 $H_0$ 은 기각됩니다. 즉 이 주사위는 공평한 주사위라고 할 수 있습니다. 

```R
ps = rep(1/6,6) 
x = c(13,19,11,8,5,4)
chisq.test(x,p=ps)
```

```
	Chi-squared test for given probabilities

data:  x
X-squared = 15.6, df = 5, p-value = 0.008084
```

- 위와 같이 기각하게 됩니다.



---

**Reference**

- Hoggs Introduction to Mathematical Statistics 7ed



